<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QueueCTL Dashboard</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background: #f8f9fa; }
        nav { background: #343a40; color: white; padding: 1rem; font-size: 1.5rem; }
        .container { max-width: 1200px; margin: 1rem auto; padding: 1rem; }
        .summary { display: flex; gap: 1rem; margin-bottom: 2rem; }
        .card { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 1.5rem; flex: 1; text-align: center; }
        .card h3 { margin: 0 0 0.5rem 0; color: #555; }
        .card p { font-size: 2.5rem; margin: 0; font-weight: 300; }
        .card.dead { color: #d9534f; }
        .card.processing { color: #0275d8; }
        .card.pending { color: #f0ad4e; }
        .card.completed { color: #5cb85c; }
        h2 { border-bottom: 2px solid #ccc; padding-bottom: 0.5rem; }
        table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        th, td { padding: 1rem; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f1f1f1; }
        tr:hover { background: #f9f9f9; }
        .state { font-weight: bold; }
        .state-dead { color: #d9534f; }
        .state-processing { color: #0275d8; }
        .state-failed { color: #f0ad4e; }
        .state-scheduled { color: #5bc0de; }
        .state-completed { color: #5cb85c; }
        .action-link { color: #0275d8; text-decoration: none; }
    </style>
</head>
<body>
    <nav>QueueCTL Dashboard</nav>
    <div class="container">
        <h2>Job Summary</h2>
        <div class="summary">
            <div class="card dead"><p>{{ summary.get('dead', 0) }}</p><h3>Dead</h3></div>
            <div class="card processing"><p>{{ summary.get('processing', 0) }}</p><h3>Processing</h3></div>
            <div class="card pending"><p>{{ summary.get('failed', 0) + summary.get('pending', 0) + summary.get('scheduled', 0) }}</p><h3>Pending / Failed / Scheduled</h3></div>
            <div class="card completed"><p>{{ summary.get('completed', 0) }}</p><h3>Completed</h3></div>
        </div>

        <h2>Dead Letter Queue (DLQ)</h2>
        {% if dlq_jobs %}
            <table>
                <tr><th>ID</th><th>Command</th><th>Attempts</th><th>Last Updated</th><th>Action</th></tr>
                {% for job in dlq_jobs %}
                <tr>
                    <td>{{ job['id'] }}</td>
                    <td><code>{{ job['command'] }}</code></td>
                    <td>{{ job['attempts'] }}</td>
                    <td>{{ job['updated_at'] }}</td>
                    <td><a href="/job/retry/{{ job['id'] }}" class="action-link">Retry</a></td>
                </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>DLQ is empty.</p>
        {% endif %}

        <h2>In-Flight Jobs (Processing, Failed, Scheduled)</h2>
        <table>
            <tr><th>ID</th><th>State</th><th>Command</th><th>Priority</th><th>Next Run (if failed)</th></tr>
            {% for job in inflight_jobs %}
            <tr>
                <td>{{ job['id'] }}</td>
                <td><span class="state state-{{ job['state'] }}">{{ job['state'] }}</span></td>
                <td><code>{{ job['command'] }}</code></td>
                <td>{{ job['priority'] }}</td>
                <td>{{ job['run_at'] or 'N/A' }}</td>
            </tr>
            {% endfor %}
        </table>

        <h2>Recent Completed Jobs</h2>
        <table>
            <tr><th>ID</th><th>Command</th><th>Completed At</th></tr>
            {% for job in completed_jobs %}
            <tr>
                <td>{{ job['id'] }}</td>
                <td><code>{{ job['command'] }}</code></td>
                <td>{{ job['completed_at'] }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
</body>
</html>
